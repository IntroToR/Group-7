---
title: "Group7 Project - Coffee Rating"
author: "Ece Gulkirpik, Johana Coronel, Mengyi Dong"
date: "10/8/2020"
output: html_document
---
```{r}
## Install and load packages
library(tidyverse)
library(tidytuesdayR)
library(ggplot2)
# Read data file
## coffee_rating
coffee_ratings <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-07-07/coffee_ratings.csv')
```

# **1. Introduction** 

  Coffee traces its origin to a genus of plants known as Coffea. The two most commercially important species grown are varieties of _Coffeaarabica_ (Arabicas) and _Coffeacanephora_ (Robustas) (ISIC, 2014).
  
  Coffee Arabica is descended from the original coffee trees discovered in Ethiopia.  These trees produce a fine, mild, aromatic coffee and represent approximately 70% of the world's coffee production. The beans are flatter and more elongated than Robusta and lower in caffeine. Most of the world's Robusta is grown in Central and Western Africa, parts of Southeast Asia, including Indonesia and Vietnam, and in Brazil. Production of Robusta is increasing, though it accounts for only about 30% of the world market. Robusta is primarily used in blends and for instant coffees. The Robusta bean itself tends to be slightly rounder and smaller than an Arabica bean (NCA, 2020). The infographic given in Figure 1 also presents some general information about the differences between Coffee Arabica and Robusta.

![Figure.1 Coffee Arabica and Robusta](https://i.imgur.com/TOLbrFK.png)

  _"Coffee_ratings"_ dataset puts together a great amount of data on the sensorial attributes of these two coffee species which were grown and processed in many different ways by various countries. This dataset not only provides valuable information about the sensory characteristics of coffee species but also gives considerable amount of background information belong to each species including farm and company names, producers, harvest years, and certifications, etc. 
  
  "Coffee_ratings" dataset includes 43 variables in which 24 of them are character and the rest are numerical. The details about the variables can be obtained from the following R chunk:
```{r}
## Getting to know the variables of "Coffee_ratings" dataset

head(coffee_ratings)

str(coffee_ratings)

```

<<<<<<< HEAD

=======
  The first step of data analysis is to identify basic statistical properties of a given dataset, such as ranges, means, medians, quantiles, max and min values of variables, etc. For this purpose, as it is shown in the following R chunk, _"summary()"_ function is used.

```{r}
# Summary statistics of the "Coffee Rating" dataset

summary(coffee_ratings)
```

# **2. Analysis**
## 2.1 Total Rating Points for Each Country - Mengyi
We hope to compare the overall rating of different country and regions. To better visualize the data, we proposed to use a map chart with a choropleth world map. Choropleth map is a type of thematic map that usually used to represent an aggregate summary of a geographic characteristic (Holtz, 2018). Here, we use a serial of color shades to represent the average/ mean overall score of coffees from different countries. Also, a summary table of the highest score, lowest score, and average score of each country is provided.
```{r}
## 2.1.1 Create a summary table with number of coffee rated, highest, lowest, and average rating score for each country.
ratingbycountry <- coffee_ratings %>%
  group_by(country_of_origin) %>%
  summarise(
    count = n(),
    highest_score = max(total_cup_points),
    lowest_score = min(total_cup_points),
    mean_score = mean(total_cup_points)
  )
## From the ratingbycountry file, we see that some of the country names are not standard names. Thus, the first thing to do is to match the country names with standard names in the world map.
ratingbycountry[6,1] <- "Ivory Coast"
ratingbycountry[29,1] <- "Tanzania"
ratingbycountry[34,1] <- "Puerto Rico"
ratingbycountry[32,1] <- "USA"
ratingbycountry[33,1] <- "USA(Hawaii)"
write.table(ratingbycountry, file = "/Users/Mengyi/Box/CPSC441 R programming/Group-7 Project/data/Overall_Rating_by_Country.txt")

## 2.1.2 Create a boxplot to display the coffee rating scores for each country.
countryrating.plot <- ggplot(coffee_ratings) +
  aes(x = country_of_origin, y = total_cup_points) +
  geom_boxplot(fill = "#d8576b") +
  labs(x = "Country of origin", y = "Total cup points", title = "Coffee Rating by Country") +
  theme_linedraw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  theme(plot.title = element_text(hjust = 0.5)) +
  ylim(55L, 95L)
ggsave("/Users/Mengyi/Box/CPSC441 R programming/Group-7 Project/Figures/ratingbycoutry.png",  width = 12, height = 5)

## 2.1.3 Create a choropleth map chart for world coffee rating.
## First, we need to load the packages.
require(maps)
require(viridis)
world_map <- map_data("world")
theme_set(
  theme_void()
)
## Second, we are going to select countries that are listed in coffee rating. USA and USA(Hawaii) are excluded from the coutry_of_orignin1 group, and they are listed seperately.
country_of_origin1 <- c("Brazil", "Burundi","China","Colombia","Costa Rica","Ivory Coast","Ecuador","El Salvador","Ethiopia","Guatemala","Haiti", "Honduras"
,"India", "Indonesia","Japan","Kenya","Laos", "Malawi","Mauritius","Mexico"               ,"Myanmar","Nicaragua","Panama", "Papua New Guinea","Peru", "Philippines"               ,"Rwanda", "Taiwan","Tanzania", "Thailand","Uganda", "Puerto Rico" ,"Vietnam", "Zambia")
world_map1 <- map_data ("world", region = country_of_origin1) 
world_Hawaii <- map_data("world", region = "USA.Hawaii") 
world_Hawaii[,5] <- "USA(Hawaii)"
world_USA <- map_data ("world", region = "USA")
world_USA1<- subset(world_USA, subregion != "Hawaii")
## Now, merge the map regions.
new_map <- rbind(world_map1,world_Hawaii,world_USA1)
## Create labels for mapping regions.
world_map1_label <- map_data ("world", region = country_of_origin1) %>%
  group_by(region) %>%
  summarise(long = mean(long), lat = mean(lat))
world_Hawaii_label <- map_data("world", region = "USA.Hawaii") %>%
  group_by(region) %>%
  summarise(long = mean(long), lat = mean(lat))
world_Hawaii_label[1,1] <- "USA(Hawaii)"
world_USA1_label<- subset(world_USA, subregion != "Hawaii")%>%
  group_by(region) %>%
  summarise(long = mean(long), lat = mean(lat))
new_map_label <- rbind(world_map1_label,world_Hawaii_label,world_USA1_label)

## Merge coffee rating data with the map data.
world_coffee_rating <- left_join(ratingbycountry,new_map, by=c("country_of_origin" = "region"))
write.table(world_coffee_rating, file = "/Users/Mengyi/Box/CPSC441 R programming/Group-7 Project/data/mapping_coffee_rating.txt")

## Create a world map.
ggplot(world_coffee_rating, aes(long, lat)) +
  geom_polygon(aes(group = group, fill = mean_score))+
  geom_text(aes(label = region), data = new_map_label, size = 2, hjust = 0.5) +
  scale_fill_viridis_c(option = "C") +
  labs(
    title = "Overall Coffee Ratings of Different Countries and Regions",
    subtitle = "Average Coffee Score for Each Region",
    caption = "Data: coffee_ratings | Creation: Mengyi Dong | CPSC441 Group-7 Project"
  ) +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme(plot.subtitle = element_text(hjust = 0.5))
ggsave("/Users/Mengyi/Box/CPSC441 R programming/Group-7 Project/Figures/map_coffee_ratings.png",  width = 24, height = 10)
```

## 2.2 Sensory Attributes of Coffee Species - Johana
Spider graph

```{r}
## Code for spider graph
```

## 2.3 The Effect of Type of Species, Altitude and Processing Method on Sensory Attributes - Ece
ANOVA
```{r}
## Code for ANOvA statistical analysis


```

# **3. Conclusion** - Together


# **4. References**

1. Institute for Scientific Information on Coffee (ISIC). (2014, November 24). Where Coffee Grows. Retrieved from https://www.coffeeandhealth.org/all-about-coffee/where-coffee-grows/ 

2. National Coffee Association (NCA). (2020). The History of Coffee. Retrieved from https://www.ncausa.org/about-coffee/history-of-coffee

3. Holtz, Yan.(2018). Choropleth Map. Retrived from https://www.r-graph-gallery.com/choropleth-map.html
